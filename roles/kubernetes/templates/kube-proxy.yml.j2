---
apiVersion: v1
kind: Pod
metadata:
  name: kube-proxy
  namespace: kube-system
  labels:
    k8s-app: kube-proxy
spec:
  containers:
    -
      command:
        - /usr/bin/run.sh
        - "--master=https://{{ ansible_ssh_host}}:6443 --proxy-mode=iptables"
        - "--logtostderr=true --kubeconfig=/etc/kubernetes/kubeconfig-kubelet"

      image: "kube-proxy:5.0"

      name: kube-proxy
      securityContext:
        privileged: true
      volumeMounts:
        -
          mountPath: /opt/k8s
          name: ssl-certs
          readOnly: true
        -
          mountPath: /etc/kubernetes
          name: etc-kube-ssl
          readOnly: true
  hostNetwork: true
  volumes:
    -
      hostPath:
        path: /opt/k8s
      name: ssl-certs
    -
      hostPath:
        path: /etc/kubernetes
      name: etc-kube-ssl
